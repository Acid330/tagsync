<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>

<body>
    <h2>Set New Password</h2>
    <input type="password" id="newPassword" placeholder="New password" />
    <button id="updateBtn">Update Password</button>
    <p id="result"></p>

    <script>
        console.log("Page loaded");

        const supabaseUrl = "https://xavaoddkhecbwpgljrzu.supabase.co";
        const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhdmFvZGRraGVjYndwZ2xqcnp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMDgwNjgsImV4cCI6MjA1OTc4NDA2OH0.Wa9QRIHobbDQgHRnAFtIM1vFzPjz4yYrOl3XTD_7Of4";

        const client = supabase.createClient(supabaseUrl, supabaseAnonKey);

        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const access_token = hashParams.get("access_token");
        const refresh_token = hashParams.get("refresh_token");

        console.log("access_token:", access_token);
        console.log("refresh_token:", refresh_token);

        const result = document.getElementById("result");
        const btn = document.getElementById("updateBtn");

        btn.addEventListener("click", async () => {
            console.log("Button clicked");

            const newPassword = document.getElementById("newPassword").value;

            if (!access_token || !refresh_token) {
                result.textContent = "❌ Missing token from URL.";
                console.log("Missing token");
                return;
            }

            console.log("Setting session...");
            const { error: sessionError } = await client.auth.setSession({
                access_token,
                refresh_token
            });

            if (sessionError) {
                result.textContent = "❌ Session error: " + sessionError.message;
                console.log("Session error", sessionError);
                return;
            }

            console.log("Session set. Updating password...");

            const { error } = await client.auth.updateUser({ password: newPassword });

            if (error) {
                result.textContent = "❌ Password update failed: " + error.message;
                console.log("Password update error", error);
            } else {
                result.textContent = "✅ Password updated successfully!";
                console.log("Password updated!");
            }
        });
    </script>
</body>
</html>
